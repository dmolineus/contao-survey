{% extends '@MvoContaoSurvey/survey.html.twig' %}

{% form_theme current_step.form '@MvoContaoSurvey/Form/survey_theme.html.twig' %}
{% trans_default_domain 'MvoContaoSurveyBundle' %}

{% block content %}
    {# @var section \Mvo\ContaoSurvey\Entity\Section #}
    {% set section = current_step.section %}
    <section data-step="{{ current_step.index }}"
             data-total-steps="{{ total_steps }}"{% if section.groupQuestions %} class="grouped"{% endif %}>
        {% block header %}
            {% if section.title or section.description %}
                <header>
                    {% if section.title %}<h3>{{ section.title }}</h3>{% endif %}
                    {% if section.description %}{{ section.description|raw }}{% endif %}
                </header>
            {% endif %}
        {% endblock header %}
        {% set form = current_step.form %}
        {{ form_start(form, {'action': path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')), 'attr': {'novalidate': 'novalidate'}}) }}
        {% block questions %}
            <div class="questions">
                {# @var question \Mvo\ContaoSurvey\Entity\Question #}
                {% for question in current_step.questions %}
                    {% block question %}
                        <div class="question{% if question.mandatory %} required{% endif %}">
                            <h4>{{ question.question }}</h4>
                            <div class="progress"
                                 style="--percent: {{ 100 * current_step.index / total_steps }}%; --percent-previous: {{ 100 * (current_step.index - 1) / total_steps }}%"
                                 title="{{ current_step.index }}/{{ total_steps }}">
                                <span>{{ current_step.index }}/{{ total_steps }}</span>
                            </div>
                            {% if question.description %}
                                <div class="description">
                                    {{ question.description|raw }}
                                </div>
                            {% endif %}
                            {% if question.image %}
                                {% block image %}
                                    {{ contao_figure(question.image, picture_config({width: 600, height: 450, resizeMode: 'proportional', sizes: '0.5,1,2'})) }}
                                {% endblock %}
                            {% endif %}
                            <fieldset data-survey>
                                <legend>{{ question.instruction }}</legend>
                                {{ form_row(form[question.name]) }}
                                <div class="reset_current">
                                    <input type="reset" value="{{ 'form.button.clear_current'|trans() }}"
                                           title="{{ 'form.button.clear_current_title'|trans() }}">
                                </div>
                            </fieldset>
                        </div>
                    {% endblock question %}
                {% endfor %}
            </div>
        {% endblock questions %}
        {% block navigation %}
            <nav class="navigation">
                {% if not current_step.mandatory -%}
                    <span class="note_skip">{{ 'form.skip'|trans({'%count%': current_step.questions|length}) }}</span>
                {%- endif %}
                {% if form.previous is defined %}
                    {{- form_widget(form.previous, {label: 'form.button.previous'|trans(), attr: {class: 'previous'}}) -}}
                {% endif %}
                {% if current_step.is_last %}
                    {{- form_widget(form.next, {label: 'form.button.submit'|trans(), attr: {class: 'next submit'}}) -}}
                {% else %}
                    {{- form_widget(form.next, {label: 'form.button.next'|trans(), attr: {class: 'next'}}) -}}
                {% endif %}
            </nav>
        {% endblock %}
        {% block footer %}
            <div class="footer">
                <span>{{ 'form.note_reset_all'|trans() }}</span>
                {{ form_widget(form.reset, {label: 'form.reset_all'|trans(), attr: {class: 'reset'}}) }}
            </div>
        {% endblock %}
        <input type="hidden" name="REQUEST_TOKEN" value="{{ '{{request_token}}' }}">
        {{ form_end(form) }}
    </section>
{% endblock content %}
